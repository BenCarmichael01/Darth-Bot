
# This workflow will automatically deploy your application to www.evennode.com on push to master branch.
# yar

name: Build Typescript then deploy to EvenNode

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build-push:
    runs-on: ubuntu-latest
    name: Builds Typescript
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16.x'

      - name: Install packages
        run: npm install
      - name: Building Typescript
        uses: FuLagann/tsc-build-push@v1
        with:
          user-name: secrets.GIT_NAME
          user-email: secrets.GIT_EMAIL
          message: "Automatically built typescript"
  Deploy:
    needs: build-push
    runs-on: ubuntu-latest
    steps:
    - name: Install SSH key
      uses: shimataro/ssh-key-action@v2
      with:
        key: ${{ secrets.SSH_KEY }}
        known_hosts: " "
    - name: Add git.evennode.com to known_hosts
      run: |
        ssh-keyscan -H git.evennode.com > ~/.ssh/known_hosts
    - name: Deploy to evennode.com
      run: |
        git remote add evennode ${{ secrets.EVENNODE_REPO_URL }}
        git config --global user.email "${{ secrets.GIT_EMAIL }}"
        git config --global user.name "${{ secrets.GIT_NAME }}"
        git push evennode +main
